function AlexCuttingImg(t){this.init(t)}AlexCuttingImg.prototype={init:function(t){var i=this;this.cuttingImgBoxID=$("#"+t.cuttingImgBoxID),this.imgID=$("#"+t.imgID),this.outside=t.outside,this.myCuttingImgBox=document.getElementById(t.imgID),this.imageInfo={left:0,top:0,tempLeft:0,tempTop:0,width:this.imgID.width(),height:this.imgID.height(),now_width:this.imgID.width(),now_height:this.imgID.height(),imgAspectRatio:this.imgID.width()/this.imgID.height(),boxAspectRatio:this.cuttingImgBoxID.width()/this.cuttingImgBoxID.height(),touchendTime:0,pinchendTime:0,zoomState:!0},this.setInit();var g=new Hammer(this.myCuttingImgBox);g.get("pan").set({direction:Hammer.DIRECTION_ALL}),g.get("pinch").set({enable:!0}),this.myCuttingImgBox.addEventListener("touchstart",function(t){i.touch(t,i)},!1),this.myCuttingImgBox.addEventListener("touchend",function(t){i.touch(t,i)},!1),g.on("pan",function(t){if((new Date).getTime()-i.imageInfo.pinchendTime>100)if(t.center.y>0){var g={left:!1,top:!1};i.outside&&(i.imageInfo.left+t.deltaX>0?(i.imgID.css("left",0),g.left=!0):i.imageInfo.left+t.deltaX<-(i.imgID.width()-i.cuttingImgBoxID.width())&&(i.imgID.css("left",-(i.imgID.width()-i.cuttingImgBoxID.width())),g.left=!0),i.imageInfo.top+t.deltaY>0?(i.imgID.css("top",0),g.top=!0):i.imageInfo.top+t.deltaY<-(i.imgID.height()-i.cuttingImgBoxID.height())&&(i.imgID.css("top",-(i.imgID.height()-i.cuttingImgBoxID.height())),g.top=!0)),g.left||i.imgID.css({left:i.imageInfo.left+t.deltaX}),g.top||i.imgID.css({top:i.imageInfo.top+t.deltaY}),t.isFinal&&(i.checkError(),setTimeout(function(){i.imageInfo.left=i.imgID.position().left,i.imageInfo.top=i.imgID.position().top},130))}else i.checkError(),setTimeout(function(){i.imageInfo.left=i.imgID.position().left,i.imageInfo.top=i.imgID.position().top},130)});var e=!1;g.on("pinch",function(t){var g=Math.round(100*t.scale)/100;e=!1,i.outside&&(i.imgID.width()*g<i.cuttingImgBoxID.width()?(i.imgID.css({width:i.imageInfo.width,height:i.imageInfo.height,left:0,top:0}),e=!0):i.imgID.height()*g<i.cuttingImgBoxID.height()&&(i.imgID.css({width:i.imageInfo.width,height:i.imageInfo.height,left:0,top:0}),e=!0)),e||i.imgID.css({width:i.imageInfo.now_width*g,height:i.imageInfo.now_height*g,left:i.imageInfo.tempLeft+(i.imageInfo.now_width-i.imgID.width())/2,top:i.imageInfo.tempTop+(i.imageInfo.now_height-i.imgID.height())/2})}),g.on("pinchend",function(t){i.imgID.width()<i.cuttingImgBoxID.width()&&i.imgID.height()<i.cuttingImgBoxID.height()&&(i.imageInfo.imgAspectRatio<i.imageInfo.boxAspectRatio?i.imgID.css({width:i.cuttingImgBoxID.height()*i.imageInfo.imgAspectRatio,height:i.cuttingImgBoxID.height(),left:(i.cuttingImgBoxID.width()-i.cuttingImgBoxID.height()*i.imageInfo.imgAspectRatio)/2,top:0}):i.imgID.css({width:i.imageInfo.width,height:i.imageInfo.height,left:0,top:0})),i.checkError(),setTimeout(function(){i.imageInfo.now_width=i.imgID.width(),i.imageInfo.now_height=i.imgID.height(),i.imageInfo.left=i.imgID.position().left,i.imageInfo.top=i.imgID.position().top},130),i.imageInfo.pinchendTime=(new Date).getTime()})},setInit:function(){this.cuttingImgBoxID.width(this.cuttingImgBoxID.width()),this.cuttingImgBoxID.height(this.cuttingImgBoxID.height()),this.imgID.width(this.imgID.width()),this.imgID.height(this.imgID.height())},touch:function(t,i){var t=t||window.event;switch(t.type){case"touchstart":i.imageInfo.tempLeft=i.imgID.position().left,i.imageInfo.tempTop=i.imgID.position().top;break;case"touchend":var g=(new Date).getTime();g-i.imageInfo.pinchendTime>300&&g-i.imageInfo.touchendTime<300&&(i.outside?i.imageInfo.zoomState?(i.imgID.css({width:2*i.imageInfo.width,height:2*i.imageInfo.height,left:-i.imageInfo.width/2,top:-i.imageInfo.height/2}),i.imageInfo.zoomState=!1):(i.imgID.css({width:i.imageInfo.width,height:i.imageInfo.height,left:0,top:0}),i.imageInfo.zoomState=!0):i.imageInfo.zoomState?(i.imgID.css({width:i.cuttingImgBoxID.height()*i.imageInfo.imgAspectRatio,height:i.cuttingImgBoxID.height(),left:(i.cuttingImgBoxID.width()-i.cuttingImgBoxID.height()*i.imageInfo.imgAspectRatio)/2,top:0}),i.imageInfo.zoomState=!1):(i.imgID.css({width:i.imageInfo.width,height:i.imageInfo.height,left:0,top:0}),i.imageInfo.zoomState=!0),i.imageInfo.now_width=i.imgID.width(),i.imageInfo.now_height=i.imgID.height(),i.imageInfo.left=i.imgID.position().left,i.imageInfo.top=i.imgID.position().top),i.imageInfo.touchendTime=(new Date).getTime(),setTimeout(function(){i.cuttingImgBoxID.children("input[name=picW]").val(Math.round(i.imgID.width())),i.cuttingImgBoxID.children("input[name=picH]").val(Math.round(i.imgID.height())),i.cuttingImgBoxID.children("input[name=picX]").val(-Math.round(i.imgID.position().left)),i.cuttingImgBoxID.children("input[name=picY]").val(-Math.round(i.imgID.position().top)),i.cuttingImgBoxID.children("input[name=picCropW]").val(Math.round(i.cuttingImgBoxID.width())),i.cuttingImgBoxID.children("input[name=picCropH]").val(Math.round(i.cuttingImgBoxID.height()))},180)}},checkError:function(){var t={top:!1,right:!1,bottom:!1,left:!1,outNum:0};this.imgID.position().left>=this.cuttingImgBoxID.width()-10&&(t.right=!0,t.outNum++),this.imgID.position().top>=this.cuttingImgBoxID.height()-10&&(t.bottom=!0,t.outNum++),this.imgID.width()+this.imgID.position().left<=10&&(t.left=!0,t.outNum++),this.imgID.height()+this.imgID.position().top<=10&&(t.top=!0,t.outNum++),2==t.outNum?t.top&&t.right?this.imgID.animate({top:-this.imgID.height()+this.cuttingImgBoxID.height()/3+"px",left:this.cuttingImgBoxID.width()-this.cuttingImgBoxID.width()/3+"px"},100):t.right&&t.bottom?this.imgID.animate({left:this.cuttingImgBoxID.width()-this.cuttingImgBoxID.width()/3+"px",top:this.cuttingImgBoxID.height()-this.cuttingImgBoxID.height()/3+"px"},100):t.bottom&&t.left?this.imgID.animate({top:this.cuttingImgBoxID.height()-this.cuttingImgBoxID.height()/3+"px",left:-this.imgID.width()+this.cuttingImgBoxID.width()/3+"px"},100):t.left&&t.top&&this.imgID.animate({left:-this.imgID.width()+this.cuttingImgBoxID.width()/3+"px",top:-this.imgID.height()+this.cuttingImgBoxID.height()/3+"px"},100):t.top?this.imgID.animate({top:-this.imgID.height()+this.cuttingImgBoxID.height()/3+"px"},100):t.right?this.imgID.animate({left:this.cuttingImgBoxID.width()-this.cuttingImgBoxID.width()/3+"px"},100):t.bottom?this.imgID.animate({top:this.cuttingImgBoxID.height()-this.cuttingImgBoxID.height()/3+"px"},100):t.left&&this.imgID.animate({left:-this.imgID.width()+this.cuttingImgBoxID.width()/3+"px"},100),t={top:!1,right:!1,bottom:!1,left:!1,outNum:0}}};